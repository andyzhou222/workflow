# 获取 Supabase 连接字符串详细步骤

## 第一步：登录 Supabase

1. 访问 https://supabase.com
2. 点击右上角 "Sign in" 或 "Start your project"
3. 使用 GitHub、Google 或邮箱注册/登录

## 第二步：创建项目（如果还没有）

1. 登录后，点击 "New Project"
2. 填写项目信息：
   - **Name**: `workflow-db`（可以自定义）
   - **Database Password**: **设置一个强密码**（⚠️ 重要：请务必记住这个密码！）
   - **Region**: 选择离你最近的区域
     - 中国用户建议选择：**Southeast Asia (Singapore)**
   - **Pricing Plan**: 选择 **Free**
3. 点击 "Create new project"
4. 等待 1-2 分钟，项目创建完成

## 第三步：获取连接字符串

### 方法一：从 Settings 页面获取（推荐）

1. **进入项目设置**
   - 在项目列表中，点击你刚创建的项目
   - 左侧菜单栏，点击 **"Settings"**（齿轮图标）

2. **进入 Database 设置**
   - 在 Settings 页面，点击左侧的 **"Database"**

3. **找到连接字符串**
   - 向下滚动，找到 **"Connection string"** 部分
   - 你会看到几个标签：**URI**, **JDBC**, **Golang**, **Python** 等
   - 点击 **"URI"** 标签

4. **复制连接字符串**
   - 你会看到类似这样的字符串：
     ```
     postgresql://postgres:[YOUR-PASSWORD]@db.xxxxx.supabase.co:5432/postgres
     ```
   - 或者：
     ```
     postgres://postgres:[YOUR-PASSWORD]@db.xxxxx.supabase.co:5432/postgres
     ```
   - **重要**：点击复制按钮，或者手动复制整个字符串

5. **替换密码**
   - 将连接字符串中的 `[YOUR-PASSWORD]` 替换为你创建项目时设置的密码
   - 例如，如果你的密码是 `MyPassword123!`，连接字符串应该是：
     ```
     postgresql://postgres:MyPassword123!@db.xxxxx.supabase.co:5432/postgres
     ```

### 方法二：从 Connection Pooling 获取（备选）

1. 在 Database 设置页面
2. 找到 **"Connection Pooling"** 部分
3. 选择 **"Session mode"** 或 **"Transaction mode"**
4. 复制连接字符串（格式类似，但端口可能是 6543）

## 第四步：在 Render 中配置

1. **登录 Render Dashboard**
   - 访问 https://dashboard.render.com
   - 进入你的后端服务（Web Service）

2. **添加环境变量**
   - 点击 **"Environment"** 标签
   - 点击 **"Add Environment Variable"** 按钮
   - 填写：
     - **Key**: `DATABASE_URL`
     - **Value**: 粘贴你刚才复制的连接字符串（已替换密码）
   - 点击 **"Save Changes"**

3. **验证格式**
   - 连接字符串应该类似：
     ```
     postgresql://postgres:你的密码@db.xxxxx.supabase.co:5432/postgres
     ```
   - 确保：
     - ✅ 没有 `[YOUR-PASSWORD]` 这样的占位符
     - ✅ 密码已经替换为实际密码
     - ✅ 整个字符串是一行，没有换行

## 完整示例

假设你创建项目时设置的密码是：`MySecurePass123!`

那么你的连接字符串应该是：
```
postgresql://postgres:MySecurePass123!@db.abcdefghijklmnop.supabase.co:5432/postgres
```

在 Render 环境变量中：
- **Key**: `DATABASE_URL`
- **Value**: `postgresql://postgres:MySecurePass123!@db.abcdefghijklmnop.supabase.co:5432/postgres`

## 常见问题

### Q: 我找不到 Connection string 在哪里？
A: 
1. 确保你已经进入项目（不是项目列表页面）
2. 点击左侧菜单的 "Settings"（齿轮图标）
3. 在 Settings 页面，点击左侧的 "Database"
4. 向下滚动找到 "Connection string" 部分

### Q: 连接字符串中有 `[YOUR-PASSWORD]` 怎么办？
A: 这是占位符，你需要：
1. 复制整个字符串
2. 将 `[YOUR-PASSWORD]` 替换为你创建项目时设置的密码
3. 确保密码中没有特殊字符需要 URL 编码（如果有，需要编码）

### Q: 密码中有特殊字符怎么办？
A: 如果密码包含特殊字符（如 `@`, `#`, `$`, `%` 等），需要进行 URL 编码：
- `@` → `%40`
- `#` → `%23`
- `$` → `%24`
- `%` → `%25`
- `&` → `%26`
- 等等

或者，在 Supabase 中重置一个简单的密码（只包含字母和数字）。

### Q: 我忘记了数据库密码怎么办？
A: 
1. 在 Supabase 项目设置中
2. 进入 "Database" → "Database Settings"
3. 找到 "Database Password" 部分
4. 点击 "Reset database password"
5. 设置新密码
6. 更新 Render 中的 `DATABASE_URL` 环境变量

### Q: 连接字符串格式不对？
A: 确保：
- 使用 **URI** 标签下的连接字符串
- 格式是：`postgresql://postgres:密码@主机:端口/数据库名`
- 或者：`postgres://postgres:密码@主机:端口/数据库名`（两种格式都可以）

## 验证配置

配置完成后，在 Render 日志中应该看到：
```
[Database Config] Using PostgreSQL: db.xxxxx.supabase.co
```

如果看到这个，说明配置成功！

